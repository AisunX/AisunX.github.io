<!doctype html>
<html lang="th" data-bs-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AisunX — Portfolio</title>
  <meta name="description" content="ผลงานและโปรเจกต์ของ AisunX บน GitHub">
  <meta property="og:title" content="AisunX — Portfolio">
  <meta property="og:description" content="รวมผลงานล่าสุด, รูป/วิดีโอ, และเอกสารอ้างอิง">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://AisunX.github.io">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-body">
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg border-bottom sticky-top bg-body">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">AisunX<span class="text-primary">.github.io</span></a>
      <div class="d-flex gap-2">
        <button id="themeToggle" class="btn btn-outline-secondary btn-sm" title="Toggle theme">
          <i class="bi bi-moon-stars"></i>
        </button>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header class="container py-5">
    <div id="heroVideoWrap" class="ratio ratio-21x9 d-none mb-3">
      <video id="heroVideo" playsinline muted autoplay loop class="rounded-4 border"></video>
    </div>
    <div id="heroImgWrap" class="d-none mb-3">
      <img id="heroImg" class="img-fluid rounded-4 border" alt="Cover">
    </div>
    <div class="row align-items-center">
      <div class="col-lg-8">
        <h1 class="display-5 fw-bold">สวัสดี นี่คือพอร์ตของ AisunX</h1>
        <p class="lead mb-3">รวมงาน dev/design ล่าสุด—ดึงจาก GitHub อัตโนมัติ + มีแกลเลอรีสื่อและเอกสาร</p>
        <div class="d-flex gap-2 flex-wrap">
          <a id="resumeBtn" href="resume.pdf" class="btn btn-primary d-none" target="_blank" rel="noopener">
            <i class="bi bi-file-earmark-person"></i> ดาวน์โหลดเรซูเม่
          </a>
          <a href="#projects" class="btn btn-outline-primary"><i class="bi bi-grid-3x3-gap"></i> ดูโปรเจกต์</a>
          <a href="#media" class="btn btn-outline-secondary"><i class="bi bi-image"></i> ดูสื่อ</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Projects -->
  <section id="projects" class="container py-5">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h2 class="h3 m-0">โปรเจกต์ล่าสุด</h2>
      <div class="d-flex gap-2">
        <select id="langFilter" class="form-select form-select-sm" style="width:200px">
          <option value="">ทุกภาษา</option>
        </select>
      </div>
    </div>
    <div id="repoGrid" class="row g-3"></div>
    <div id="repoEmpty" class="text-muted text-center py-4 d-none">ยังไม่พบโปรเจกต์ที่ตรงเงื่อนไข</div>
  </section>

  <!-- Media -->
  <section id="media" class="container py-5">
    <h2 class="h3">สื่อ (รูป/วิดีโอ)</h2>
    <div id="mediaGrid" class="row g-3"></div>
    <div id="mediaEmpty" class="text-muted text-center py-3 d-none">ยังไม่มีไฟล์ใน <code>portfolio-assets/media</code></div>
    <hr class="my-4">
    <h3 class="h5">เอกสาร (PDF/Word/Excel)</h3>
    <ul id="docList" class="list-group"></ul>
    <div id="docEmpty" class="text-muted text-center py-3 d-none">ยังไม่มีไฟล์ใน <code>portfolio-assets/docs</code></div>
  </section>

  <footer class="container py-5 border-top text-center text-muted">
    <div>© <span id="year"></span> AisunX — Powered by GitHub Pages</div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  // ========== CONFIG ==========
  const CONFIG = {
    githubUser: 'AisunX',
    assetsRepo: 'portfolio-assets',
    reposToExclude: ['AisunX.github.io', 'portfolio-assets'],
    maxRepos: 6
  };

  // ========== THEME ==========
  const themeToggle = document.getElementById('themeToggle');
  function setTheme(t){ document.documentElement.setAttribute('data-bs-theme', t); localStorage.setItem('theme', t); }
  themeToggle.addEventListener('click', () => {
    const cur = document.documentElement.getAttribute('data-bs-theme') || 'light';
    setTheme(cur === 'light' ? 'dark' : 'light');
  });
  setTheme(localStorage.getItem('theme') || 'light');

  // ========== HERO DETECTION ==========
  async function fileExists(path){ try{ const r = await fetch(path, {method:'HEAD'}); return r.ok; }catch{ return false; } }
  (async () => {
    const hasVideo = await fileExists('promo.mp4');
    const hasCover = await fileExists('cover.png');
    if(hasVideo){
      const v = document.getElementById('heroVideo'); v.src = 'promo.mp4';
      document.getElementById('heroVideoWrap').classList.remove('d-none');
    }else if(hasCover){
      const i = document.getElementById('heroImg'); i.src = 'cover.png';
      document.getElementById('heroImgWrap').classList.remove('d-none');
    }
    if(await fileExists('resume.pdf')){
      document.getElementById('resumeBtn').classList.remove('d-none');
    }
  })();

  // ========== UTIL ==========
  function fmtDate(str){ return new Date(str).toLocaleDateString('th-TH'); }
  function iconByExt(name){
    const ext = name.split('.').pop().toLowerCase();
    if(['png','jpg','jpeg','gif','webp','svg'].includes(ext)) return 'bi-image';
    if(['mp4','webm','mov'].includes(ext)) return 'bi-film';
    if(['pdf'].includes(ext)) return 'bi-file-earmark-pdf';
    if(['doc','docx'].includes(ext)) return 'bi-file-earmark-word';
    if(['xls','xlsx','csv'].includes(ext)) return 'bi-file-earmark-excel';
    return 'bi-file-earmark';
  }

  // ========== GITHUB ==========
  async function loadRepos(){
    const url = `https://api.github.com/users/${CONFIG.githubUser}/repos?per_page=100&sort=updated`;
    const res = await fetch(url);
    if(!res.ok){ console.warn('GitHub rate limit?'); return []; }
    const data = await res.json();
    return data
      .filter(r => !r.fork)
      .filter(r => !CONFIG.reposToExclude.includes(r.name))
      .slice(0, CONFIG.maxRepos);
  }

  function renderRepos(repos){
    const grid = document.getElementById('repoGrid');
    const empty = document.getElementById('repoEmpty');
    grid.innerHTML = '';
    if(!repos.length){ empty.classList.remove('d-none'); return; }
    empty.classList.add('d-none');

    // สร้างรายการภาษาให้ฟิลเตอร์
    const langs = new Set(repos.map(r => r.language).filter(Boolean));
    const langSel = document.getElementById('langFilter');
    langs.forEach(l => {
      const opt = document.createElement('option'); opt.value = l; opt.textContent = l; langSel.appendChild(opt);
    });
    langSel.addEventListener('change', () => {
      [...grid.children].forEach(card => {
        const lang = card.getAttribute('data-lang') || '';
        card.classList.toggle('d-none', langSel.value && lang !== langSel.value);
      });
      // แสดงข้อความว่างเมื่อกรองแล้วไม่เหลือ
      const left = [...grid.children].filter(c => !c.classList.contains('d-none')).length;
      document.getElementById('repoEmpty').classList.toggle('d-none', left !== 0);
    });

    repos.forEach(r => {
      const col = document.createElement('div');
      col.className = 'col-12 col-md-6 col-lg-4';
      col.setAttribute('data-lang', r.language || '');
      col.innerHTML = `
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <h3 class="h6 card-title mb-1">
              <a href="${r.html_url}" target="_blank" rel="noopener" class="link-body-emphasis">${r.name}</a>
            </h3>
            <p class="card-text small text-muted flex-grow-1">${r.description || ''}</p>
            <div class="d-flex justify-content-between align-items-center small">
              <span><i class="bi bi-code-slash"></i> ${r.language || 'N/A'}</span>
              <span class="text-nowrap"><i class="bi bi-star"></i> ${r.stargazers_count} · <i class="bi bi-git"></i> ${fmtDate(r.updated_at)}</span>
            </div>
          </div>
        </div>`;
      grid.appendChild(col);
    });
  }

  async function loadContents(path){
    const url = `https://api.github.com/repos/${CONFIG.githubUser}/${CONFIG.assetsRepo}/contents/${path}`;
    const res = await fetch(url);
    if(!res.ok) return [];
    return await res.json(); // [{name, path, download_url, type}]
  }

  function renderMedia(items){
    const grid = document.getElementById('mediaGrid');
    const empty = document.getElementById('mediaEmpty');
    grid.innerHTML = '';
    if(!items.length){ empty.classList.remove('d-none'); return; }
    empty.classList.add('d-none');

    items.forEach(it => {
      const ext = it.name.split('.').pop().toLowerCase();
      const col = document.createElement('div');
      col.className = 'col-12 col-md-6 col-lg-4';
      if(['mp4','webm','mov'].includes(ext)){
        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <video controls class="card-img-top rounded-top" src="${it.download_url}"></video>
            <div class="card-body small d-flex justify-content-between align-items-center">
              <span><i class="bi ${iconByExt(it.name)}"></i> ${it.name}</span>
              <a class="btn btn-sm btn-outline-secondary" href="${it.download_url}" target="_blank" rel="noopener">เปิด</a>
            </div>
          </div>`;
      }else{
        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <img loading="lazy" class="card-img-top" src="${it.download_url}" alt="${it.name}">
            <div class="card-body small d-flex justify-content-between align-items-center">
              <span><i class="bi ${iconByExt(it.name)}"></i> ${it.name}</span>
              <a class="btn btn-sm btn-outline-secondary" href="${it.download_url}" target="_blank" rel="noopener">เปิด</a>
            </div>
          </div>`;
      }
      grid.appendChild(col);
    });
  }

  function renderDocs(items){
    const list = document.getElementById('docList');
    const empty = document.getElementById('docEmpty');
    list.innerHTML = '';
    if(!items.length){ empty.classList.remove('d-none'); return; }
    empty.classList.add('d-none');

    items.forEach(it => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
        <div><i class="bi ${iconByExt(it.name)}"></i> ${it.name}</div>
        <a class="btn btn-sm btn-outline-primary" href="${it.download_url}" target="_blank" rel="noopener">เปิด</a>`;
      list.appendChild(li);
    });
  }

  // Boot
  document.getElementById('year').textContent = new Date().getFullYear();

  (async () => {
    try{
      const repos = await loadRepos();
      renderRepos(repos);
    }catch(e){ console.error(e); }

    try{
      const media = await loadContents('media');
      renderMedia(media.filter(x => x.type === 'file'));
    }catch(e){ console.error(e); }

    try{
      const docs = await loadContents('docs');
      renderDocs(docs.filter(x => x.type === 'file'));
    }catch(e){ console.error(e); }
  })();
  </script>
</body>
</html>
