<!doctype html>
<html lang="th" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portfolio from GitHub</title>
  <!-- Bootstrap 5 & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Marked (Markdown) & DOMPurify (sanitize) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  <style>
    :root{--card-r:1.25rem}
    body{min-height:100vh}
    .sticky-top-blur{backdrop-filter:saturate(180%) blur(6px); background:rgba(16,16,19,.6)}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:1rem}
    .card{border-radius:var(--card-r)}
    .preview-embed{aspect-ratio:16/9; width:100%; border:0; border-radius: .75rem}
    .thumb{width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:.75rem}
    .badge-case{text-transform:uppercase; letter-spacing:.04em}
    .skeleton{background: linear-gradient(90deg,#2a2d33 25%,#333842 37%,#2a2d33 63%); background-size:400% 100%; animation:skeleton 1.4s ease infinite}
    @keyframes skeleton{0%{background-position:100% 50%} 100%{background-position:0 50%}}
    .cursor{cursor:pointer}
  </style>
</head>
<body class="bg-body text-body">
  <!-- Top Bar -->
  <header class="sticky-top sticky-top-blur border-bottom">
    <div class="container py-3">
      <div class="d-flex gap-2 align-items-center flex-wrap">
        <i class="bi bi-magic fs-4 text-primary"></i>
        <h1 class="h5 m-0 me-auto">Portfolio from GitHub</h1>
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="darkSwitch" checked>
          <label class="form-check-label" for="darkSwitch"><i class="bi bi-moon-stars"></i></label>
        </div>
      </div>
      <div class="row g-2 mt-2">
        <div class="col-6 col-md-3"><input id="owner" class="form-control" placeholder="GitHub Owner (‡πÄ‡∏ä‡πà‡∏ô uio00799)"></div>
        <div class="col-6 col-md-3"><input id="repo" class="form-control" placeholder="Repository (‡πÄ‡∏ä‡πà‡∏ô CodeBreaker-Academy)"></div>
        <div class="col-6 col-md-3"><input id="path" class="form-control" placeholder="Path (‡πÄ‡∏ä‡πà‡∏ô portfolio/) - ‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ"></div>
        <div class="col-6 col-md-3"><input id="token" class="form-control" placeholder="Personal Access Token (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)" type="password"></div>
      </div>
      <div class="d-flex gap-2 mt-2 flex-wrap">
        <button id="loadBtn" class="btn btn-primary"><i class="bi bi-play"></i> ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏•‡∏á‡∏≤‡∏ô</button>
        <button id="upBtn" class="btn btn-outline-secondary"><i class="bi bi-arrow-up"></i> ‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö</button>
        <div class="ms-auto d-flex gap-2 align-items-center flex-wrap">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input id="search" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå/‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç...">
          </div>
          <select id="filter" class="form-select">
            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</option>
            <option value="video">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</option>
            <option value="audio">‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
            <option value="pdf">PDF</option>
            <option value="word">Word</option>
            <option value="excel">Excel/CSV</option>
            <option value="ppt">PowerPoint</option>
            <option value="md">Markdown</option>
            <option value="prompt">AI Prompts</option>
            <option value="code">‡πÇ‡∏Ñ‡πâ‡∏î</option>
            <option value="zip">‡πÑ‡∏ü‡∏•‡πå‡∏ö‡∏µ‡∏ö‡∏≠‡∏±‡∏î</option>
          </select>
          <select id="sort" class="form-select">
            <option value="name">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ä‡∏∑‡πà‡∏≠ A‚ÜíZ</option>
            <option value="nameDesc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ä‡∏∑‡πà‡∏≠ Z‚ÜíA</option>
            <option value="type">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
          </select>
        </div>
      </div>
      <div id="crumbs" class="small text-body-secondary mt-2"></div>
      <div class="small mt-1">
        <span class="me-2">üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå <code>portfolio/</code> ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô <code>images/</code>, <code>videos/</code>, <code>docs/</code>, <code>prompts/</code> ‡∏à‡∏∞‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏™‡∏∏‡∏î</span>
      </div>
    </div>
  </header>

  <main class="container my-4">
    <div id="stats" class="mb-2 small text-body-secondary"></div>
    <div id="grid" class="grid"></div>
  </main>

  <!-- Modal Preview -->
  <div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="previewTitle">‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="previewBody">
          <div class="ratio ratio-16x9 skeleton" id="loadingPreview"></div>
        </div>
        <div class="modal-footer">
          <a id="openGitHub" class="btn btn-outline-secondary" target="_blank"><i class="bi bi-box-arrow-up-right"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏ô GitHub</a>
          <a id="downloadRaw" class="btn btn-primary" target="_blank"><i class="bi bi-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>
        </div>
      </div>
    </div>
  </div>

  <template id="cardTpl">
    <div class="card h-100 shadow-sm">
      <div class="p-2">
        <img class="thumb skeleton" loading="lazy" alt="preview" />
      </div>
      <div class="card-body pt-0 d-flex flex-column">
        <div class="d-flex align-items-center justify-content-between">
          <span class="badge rounded-pill text-bg-secondary badge-case cat">other</span>
          <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-secondary previewBtn"><i class="bi bi-eye"></i></button>
            <a class="btn btn-outline-secondary githubBtn" target="_blank" title="Open on GitHub"><i class="bi bi-github"></i></a>
            <a class="btn btn-outline-secondary rawBtn" target="_blank" title="Download raw"><i class="bi bi-download"></i></a>
          </div>
        </div>
        <h6 class="mt-2 text-truncate name"></h6>
        <div class="small text-body-secondary path text-truncate"></div>
      </div>
    </div>
  </template>

  <script>
    // ===== Config & State =====
    const els = {
      owner: document.getElementById('owner'),
      repo: document.getElementById('repo'),
      path: document.getElementById('path'),
      token: document.getElementById('token'),
      loadBtn: document.getElementById('loadBtn'),
      upBtn: document.getElementById('upBtn'),
      search: document.getElementById('search'),
      filter: document.getElementById('filter'),
      sort: document.getElementById('sort'),
      crumbs: document.getElementById('crumbs'),
      grid: document.getElementById('grid'),
      stats: document.getElementById('stats'),
      modal: new bootstrap.Modal(document.getElementById('previewModal')),
      previewTitle: document.getElementById('previewTitle'),
      previewBody: document.getElementById('previewBody'),
      openGitHub: document.getElementById('openGitHub'),
      downloadRaw: document.getElementById('downloadRaw'),
      darkSwitch: document.getElementById('darkSwitch')
    };

    const state = {
      owner: localStorage.getItem('gh_owner') || '',
      repo: localStorage.getItem('gh_repo') || '',
      branch: 'main',
      path: localStorage.getItem('gh_path') || '',
      token: localStorage.getItem('gh_token') || '',
      items: [],
      viewItems: []
    };

    // Prefill inputs
    els.owner.value = state.owner; els.repo.value = state.repo; els.path.value = state.path; els.token.value = state.token;

    // Theme switch
    els.darkSwitch.addEventListener('change', () => {
      document.documentElement.setAttribute('data-bs-theme', els.darkSwitch.checked ? 'dark' : 'light');
    });

    const catMap = {
      image: ['png','jpg','jpeg','gif','webp','svg','avif'],
      video: ['mp4','webm','mov','m4v'],
      audio: ['mp3','wav','ogg','m4a','flac'],
      pdf: ['pdf'],
      word: ['doc','docx'],
      excel: ['xls','xlsx','csv'],
      ppt: ['ppt','pptx'],
      md: ['md','markdown'],
      prompt: ['prompt','ai','txt','json','yaml','yml'],
      code: ['js','ts','py','cs','rb','php','html','css','c','cpp','java','lua','r','ipynb','sql'],
      zip: ['zip','rar','7z'],
    };

    function extOf(name){
      const n = name.toLowerCase();
      const dot = n.lastIndexOf('.');
      const ext = dot>0 ? n.slice(dot+1) : '';
      // Heuristic for prompts
      if(n.includes('prompt') || n.includes('claude')) return 'prompt';
      return ext;
    }

    function detectCat(name){
      const ext = extOf(name);
      for(const [cat, list] of Object.entries(catMap)){
        if(list.includes(ext)) return cat;
      }
      return 'other';
    }

    function headers(){
      const h = { 'Accept':'application/vnd.github+json'};
      const token = els.token.value.trim();
      if(token) h['Authorization'] = `Bearer ${token}`;
      return h;
    }

    async function getDefaultBranch(owner, repo){
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {headers: headers()});
      if(!res.ok) throw new Error('‡∏´‡∏≤ repo ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏î‡∏ô rate limit');
      const data = await res.json();
      return data.default_branch || 'main';
    }

    function rawUrl(owner, repo, branch, path){
      // Ensure no leading './'
      const p = path.replace(/^\.\//,'');
      return `https://raw.githubusercontent.com/${owner}/${repo}/${encodeURIComponent(branch)}/${p}`;
    }

    async function listDir(owner, repo, branch, dirPath){
      const url = `https://api.github.com/repos/${owner}/${repo}/contents/${dirPath?encodeURIComponent(dirPath):''}?ref=${encodeURIComponent(branch)}`;
      const res = await fetch(url, {headers: headers()});
      if(!res.ok) throw new Error('‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
      return await res.json(); // array of items
    }

    function setCrumbs(path){
      const parts = (path||'').split('/').filter(Boolean);
      let acc = '';
      let html = `<span class="text-body">/</span> <a class="link-secondary cursor" data-path="">root</a>`;
      parts.forEach((p,i)=>{
        acc += (i?'/':'') + p;
        html += ` <span class="text-body">/</span> <a class="link-secondary cursor" data-path="${acc}">${p}</a>`
      });
      els.crumbs.innerHTML = html;
      els.crumbs.querySelectorAll('a[data-path]').forEach(a=>{
        a.addEventListener('click', ()=>{ state.path = a.dataset.path; els.path.value = state.path; load();});
      });
    }

    function renderStats(){
      const total = state.items.length;
      const view = state.viewItems.length;
      els.stats.textContent = `‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | ‡πÅ‡∏™‡∏î‡∏á ${view} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }

    function createCard(item){
      const tpl = document.getElementById('cardTpl').content.cloneNode(true);
      const img = tpl.querySelector('img.thumb');
      const nameEl = tpl.querySelector('.name');
      const pathEl = tpl.querySelector('.path');
      const catEl = tpl.querySelector('.cat');
      const ghBtn = tpl.querySelector('.githubBtn');
      const rawBtn = tpl.querySelector('.rawBtn');
      const previewBtn = tpl.querySelector('.previewBtn');

      const cat = detectCat(item.name);
      catEl.textContent = cat;

      nameEl.textContent = item.name;
      pathEl.textContent = item.path || item.name;
      ghBtn.href = item.html_url;
      rawBtn.href = rawUrl(state.owner, state.repo, state.branch, item.path);

      // Thumbnail chooser
      const rUrl = rawBtn.href;
      if(cat==='image') img.src = rUrl;
      else if(cat==='video') img.src = 'https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?q=80&w=800&auto=format&fit=crop';
      else if(cat==='pdf') img.src = 'https://images.unsplash.com/photo-1512758017271-d7b84c2113f1?q=80&w=800&auto=format&fit=crop';
      else if(cat==='word') img.src = 'https://images.unsplash.com/photo-1587620962725-abab7fe55159?q=80&w=800&auto=format&fit=crop';
      else if(cat==='excel') img.src = 'https://images.unsplash.com/photo-1551281044-8b89ac2a2a1b?q=80&w=800&auto=format&fit=crop';
      else if(cat==='ppt') img.src = 'https://images.unsplash.com/photo-1487014679447-9f8336841d58?q=80&w=800&auto=format&fit=crop';
      else if(cat==='md' || cat==='prompt') img.src = 'https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=800&auto=format&fit=crop';
      else if(cat==='audio') img.src = 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?q=80&w=800&auto=format&fit=crop';
      else img.src = 'https://images.unsplash.com/photo-1551033406-611cf9a28f67?q=80&w=800&auto=format&fit=crop';

      img.addEventListener('load', ()=> img.classList.remove('skeleton'));

      previewBtn.addEventListener('click', ()=> openPreview(item, cat, rUrl));

      return tpl;
    }

    function applyFilterSort(){
      const q = els.search.value.trim().toLowerCase();
      const f = els.filter.value;
      let arr = [...state.items];
      if(q){ arr = arr.filter(x => (x.name.toLowerCase().includes(q) || (x.path||'').toLowerCase().includes(q))); }
      if(f !== 'all'){
        arr = arr.filter(x => detectCat(x.name) === f);
      }
      const s = els.sort.value;
      arr.sort((a,b)=>{
        if(s==='name') return a.name.localeCompare(b.name);
        if(s==='nameDesc') return b.name.localeCompare(a.name);
        if(s==='type') return detectCat(a.name).localeCompare(detectCat(b.name)) || a.name.localeCompare(b.name);
        return 0;
      });
      state.viewItems = arr;
      els.grid.innerHTML = '';
      arr.forEach(item => els.grid.appendChild(createCard(item)));
      renderStats();
    }

    async function load(){
      try{
        els.grid.innerHTML = '';
        els.stats.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
        // Save inputs
        state.owner = els.owner.value.trim();
        state.repo = els.repo.value.trim();
        state.path = els.path.value.trim();
        localStorage.setItem('gh_owner', state.owner);
        localStorage.setItem('gh_repo', state.repo);
        localStorage.setItem('gh_path', state.path);
        localStorage.setItem('gh_token', els.token.value.trim());

        state.branch = await getDefaultBranch(state.owner, state.repo);
        setCrumbs(state.path);

        const entries = await listDir(state.owner, state.repo, state.branch, state.path);
        // Keep only files for grid; add folders at top as virtual nav cards
        const folders = entries.filter(e=>e.type==='dir');
        const files = entries.filter(e=>e.type==='file').map(e=>({
          name: e.name,
          path: e.path,
          html_url: e.html_url,
          download_url: e.download_url
        }));

        // Render folder chips under crumbs
        if(folders.length){
          let chips = '<div class="mb-3 d-flex flex-wrap gap-2">';
          for(const d of folders){
            chips += `<span class="badge rounded-pill text-bg-primary cursor" data-go="${d.path}"><i class='bi bi-folder2-open me-1'></i>${d.name}</span>`
          }
          chips += '</div>';
          els.grid.insertAdjacentHTML('beforebegin', chips);
          document.querySelectorAll('[data-go]').forEach(el=> el.addEventListener('click', ()=>{ state.path = el.dataset.go; els.path.value = state.path; load();}));
        }

        state.items = files;
        applyFilterSort();
      }catch(err){
        console.error(err);
        els.stats.textContent = '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message + ' ‚Äî ‡∏•‡∏≠‡∏á‡πÉ‡∏™‡πà Token ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î rate limit ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ owner/repo/path ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
      }
    }

    function parentPath(p){
      if(!p) return '';
      const parts = p.split('/').filter(Boolean);
      parts.pop();
      return parts.join('/');
    }

    function openPreview(item, cat, rUrl){
      els.previewTitle.textContent = item.name;
      els.openGitHub.href = item.html_url;
      els.downloadRaw.href = rUrl;
      els.previewBody.innerHTML = '<div class="ratio ratio-16x9 skeleton"></div>';

      // Render by category
      if(cat==='image'){
        const img = new Image(); img.className='thumb'; img.src=rUrl; img.loading='eager';
        img.style.width='100%'; img.style.height='auto';
        img.addEventListener('load', ()=>{ els.previewBody.innerHTML=''; els.previewBody.appendChild(img);});
      }
      else if(cat==='video'){
        const v = document.createElement('video'); v.src=rUrl; v.controls=true; v.className='w-100'; v.style.borderRadius='.75rem'; v.setAttribute('playsinline','');
        els.previewBody.innerHTML=''; els.previewBody.appendChild(v);
      }
      else if(cat==='audio'){
        const a = document.createElement('audio'); a.src=rUrl; a.controls=true; a.className='w-100';
        els.previewBody.innerHTML=''; els.previewBody.appendChild(a);
      }
      else if(cat==='pdf'){
        const iframe = document.createElement('iframe'); iframe.className='preview-embed'; iframe.src = rUrl; // try direct first
        els.previewBody.innerHTML=''; els.previewBody.appendChild(iframe);
      }
      else if(cat==='word' || cat==='excel' || cat==='ppt'){
        const viewer = `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(rUrl)}`;
        const iframe = document.createElement('iframe'); iframe.className='preview-embed'; iframe.src = viewer;
        els.previewBody.innerHTML=''; els.previewBody.appendChild(iframe);
      }
      else if(cat==='md' || cat==='prompt' || item.name.toLowerCase().endsWith('.txt')){
        fetch(rUrl).then(r=>r.text()).then(txt=>{
          const md = marked.parse(txt, {mangle:true, headerIds:true});
          const safe = DOMPurify.sanitize(md);
          const box = document.createElement('div'); box.className='p-3 bg-body-tertiary rounded'; box.innerHTML = safe;
          els.previewBody.innerHTML=''; els.previewBody.appendChild(box);
        }).catch(()=>{
          els.previewBody.innerHTML='<p class="text-danger">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>';
        });
      }
      else{
        els.previewBody.innerHTML = `<div class='alert alert-warning'>‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ</div>`;
      }

      els.modal.show();
    }

    // Handlers
    els.loadBtn.addEventListener('click', load);
    els.upBtn.addEventListener('click', ()=>{ state.path = parentPath(state.path); els.path.value = state.path; load(); });
    els.search.addEventListener('input', applyFilterSort);
    els.filter.addEventListener('change', applyFilterSort);
    els.sort.addEventListener('change', applyFilterSort);

    // Auto-init if owner/repo already set
    if(state.owner && state.repo) load();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
